{% extends 'dashboard/dashboard.html' %}
{% block main %}
    <main class="main-content max-height-vh-100 h-100">
        <form action="/upload" method="post" style="border: 1px solid red" enctype="multipart/form-data">
            <input type="text" style="display: none" id="filename" name="filename"/>
            <input type="text" style="display: none" id="fileObject" name="file_content"/>
            {{ form.csrf_token }}
            <input type="file" />
            <button type="submit">add file</button>
        </form>
    </main>
{% endblock %}
{% block scripts %}
    {{ super() }}
    <script type="text/javascript">
      const download = (base64string, filename) => {
        fetch(base64string).then((res) => {
          res.blob().then(
            (response) => {
              console.log(response);
              const a = document.createElement('a');
              // Passing the blob downloading url
              a.setAttribute('href', URL.createObjectURL(response))
              // Setting the anchor tag attribute for downloading
              // and passing the download file name
              a.setAttribute('download', filename);
              // Performing a download with click
              a.click();
            }
          )
        });
      }

      document.getElementById('fileUpload').addEventListener("change", (event) => {
        const reader = new FileReader();
        console.log(event.target.files[0].name);
        const filename = event.target.files.length > 0 ? event.target.files[0].name : null;
        if (filename === null) {
          return;
        }
        reader.onload = () => {
          console.log(reader);
          document.getElementById('filename').value = filename;
          document.getElementById('fileObject').value = reader.result;
        }
        reader.readAsDataURL(event.target.files[0]);
      });

      document.getElementById('form').addEventListener('submit', function () {
        const xhttp = new XMLHttpRequest();
        xhttp.setRequestHeader('X-CSRFToken', document.getElementById('csrf_token').value);
        xhttp.onreadystatechange = function () {
          if (this.readyState === 4 && this.status === 201) {
            document.getElementById("demo").innerHTML = this.responseText;
          }
        };
        xhttp.open("POST", "{{ url_for('upload') }}", true);
        xhttp.send();
      });

    </script>
{% endblock %}
